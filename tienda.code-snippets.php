{"generator":"Code Snippets v3.9.3","date_created":"2026-01-19 13:12","snippets":[{"id":10,"name":"Tienda","code":"add_shortcode( 'mebook_tienda_premium', 'funcion_tienda_premium_html' );\n\nfunction funcion_tienda_premium_html() {\n    global $wpdb;\n\n    \/\/ ============================================================\n    \/\/ 1. L\u00d3GICA DE FILTRADO (PHP + SQL)\n    \/\/ ============================================================\n    \n    \/\/ Capturar filtros de la URL\n    $busqueda = isset($_GET['q']) ? sanitize_text_field($_GET['q']) : '';\n    $cat_filtro = isset($_GET['categoria']) ? sanitize_text_field($_GET['categoria']) : '';\n    $orden = isset($_GET['orden']) ? sanitize_text_field($_GET['orden']) : 'recientes';\n\n    \/\/ Construir consulta SQL base\n    $sql = \"SELECT * FROM libros WHERE disponibilidad = 'disponible'\";\n\n    \/\/ Filtro B\u00fasqueda (T\u00edtulo o Autor)\n    if ( !empty($busqueda) ) {\n        $sql .= \" AND (titulo LIKE '%$busqueda%' OR autor LIKE '%$busqueda%')\";\n    }\n\n    \/\/ Filtro Categor\u00eda (Usamos LIKE para multicategor\u00edas)\n    if ( !empty($cat_filtro) ) {\n        $sql .= \" AND categorias LIKE '%$cat_filtro%'\";\n    }\n\n    \/\/ Ordenamiento\n    switch ($orden) {\n        case 'precio_asc': $sql .= \" ORDER BY precio ASC\"; break;\n        case 'precio_desc': $sql .= \" ORDER BY precio DESC\"; break;\n        default: $sql .= \" ORDER BY id DESC\"; break; \/\/ Recientes\n    }\n\n    $libros = $wpdb->get_results($sql);\n    $total_libros = count($libros);\n\n    \/\/ ============================================================\n    \/\/ 2. HTML Y DISE\u00d1O (Tu c\u00f3digo adaptado)\n    \/\/ ============================================================\n    ob_start();\n    ?>\n    \n    <link href=\"https:\/\/fonts.googleapis.com\/css2?family=Lexend:wght@300;400;500;600;700&display=swap\" rel=\"stylesheet\"\/>\n    <link href=\"https:\/\/fonts.googleapis.com\/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap\" rel=\"stylesheet\"\/>\n    <script src=\"https:\/\/cdn.tailwindcss.com?plugins=forms,container-queries\"><\/script>\n    <script>\n        tailwind.config = {\n            darkMode: \"class\",\n            theme: {\n                extend: {\n                    colors: {\n                        \"primary\": \"#004c42\",\n                        \"primary-hover\": \"#003831\",\n                        \"background-light\": \"#f5f8f8\",\n                        \"text-main\": \"#101817\",\n                        \"text-secondary\": \"#5e8d87\",\n                    },\n                    fontFamily: { \"display\": [\"Lexend\", \"sans-serif\"] }\n                }\n            }\n        }\n    <\/script>\n\n    <div class=\"bg-background-light font-display text-text-main antialiased w-full min-h-screen\">\n        \n        <div class=\"w-full max-w-7xl mx-auto px-4 md:px-10 py-6 md:py-8 gap-8 flex flex-col md:flex-row\">\n\n            <aside class=\"w-full md:w-64 lg:w-72 flex-shrink-0 flex flex-col gap-6\">\n                <form method=\"GET\" action=\"<?php echo get_permalink(); ?>\">\n                    \n                    <div class=\"bg-white p-5 rounded-2xl shadow-sm border border-[#f0f5f4] flex flex-col gap-6 sticky top-24\">\n                        \n                        <div class=\"flex items-center justify-between border-b border-[#f0f5f4] pb-4\">\n                            <div>\n                                <h2 class=\"text-text-main font-bold text-lg\">Filtrar<\/h2>\n                                <p class=\"text-text-secondary text-xs\"><?php echo $total_libros; ?> resultados<\/p>\n                            <\/div>\n                            <a href=\"<?php echo get_permalink(); ?>\" class=\"text-primary text-xs font-bold hover:underline\">Limpiar<\/a>\n                        <\/div>\n\n                        <div class=\"flex flex-col gap-2\">\n                            <label class=\"font-medium text-sm\">Buscar:<\/label>\n                            <input type=\"text\" name=\"q\" value=\"<?php echo esc_attr($busqueda); ?>\" placeholder=\"T\u00edtulo o Autor...\" class=\"w-full rounded-lg border-gray-200 text-sm focus:ring-primary focus:border-primary\">\n                        <\/div>\n\n                        <div class=\"flex flex-col gap-3\">\n                            <div class=\"flex items-center gap-2 text-text-main font-medium\">\n                                <span class=\"material-symbols-outlined text-primary\">category<\/span>\n                                <span>Categor\u00edas<\/span>\n                            <\/div>\n                            <div class=\"flex flex-col gap-2 max-h-60 overflow-y-auto\">\n                                <?php \n                                $cats_disponibles = ['Novela', 'Acad\u00e9mico', 'Ciencia Ficci\u00f3n', 'Infantil', 'Terror', 'Cocina', 'Manga', 'Historia'];\n                                foreach($cats_disponibles as $cat): \n                                    $checked = ($cat_filtro == $cat) ? 'checked' : '';\n                                ?>\n                                <label class=\"flex items-center gap-3 cursor-pointer group\">\n                                    <input type=\"radio\" name=\"categoria\" value=\"<?php echo $cat; ?>\" <?php echo $checked; ?> class=\"text-primary focus:ring-primary w-4 h-4 bg-transparent border-gray-300\">\n                                    <span class=\"text-sm text-text-main group-hover:text-primary transition-colors\"><?php echo $cat; ?><\/span>\n                                <\/label>\n                                <?php endforeach; ?>\n                            <\/div>\n                        <\/div>\n\n                        <button type=\"submit\" class=\"w-full h-11 bg-primary hover:bg-primary-hover text-white rounded-xl font-bold text-sm tracking-wide mt-2 shadow-md transition-colors flex items-center justify-center gap-2\">\n                            Aplicar Filtros\n                        <\/button>\n                    <\/div>\n                <\/form>\n            <\/aside>\n\n            <div class=\"flex-1 flex flex-col w-full\">\n                \n                <div class=\"flex flex-col sm:flex-row sm:items-end justify-between gap-4 mb-6\">\n                    <div>\n                        <h1 class=\"text-3xl font-bold text-text-main tracking-tight\">Cat\u00e1logo<\/h1>\n                        <p class=\"text-text-secondary mt-1\">Explora libros disponibles en Loja.<\/p>\n                    <\/div>\n                <\/div>\n\n                <div class=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6\">\n                    \n                    <?php if ( empty($libros) ) : ?>\n                        <div class=\"col-span-3 text-center py-10\">\n                            <p class=\"text-xl text-gray-400\">\ud83d\ude22 No encontramos libros con esos filtros.<\/p>\n                            <a href=\"<?php echo get_permalink(); ?>\" class=\"text-primary font-bold underline\">Ver todos los libros<\/a>\n                        <\/div>\n                    <?php else : ?>\n\n                        <?php foreach ( $libros as $libro ) : \n                            \/\/ Parche Imagen\n                            $img_final = $libro->imagen;\n                            if ( strpos($libro->imagen, 'wp-content') !== false ) {\n                                $partes = explode('\/wp-content\/', $libro->imagen);\n                                if ( count($partes) > 1 ) $img_final = get_home_url() . '\/wp-content\/' . $partes[1];\n                            }\n\n                            \/\/ Datos Vendedor\n                            $vendedor = get_userdata($libro->usuario_id);\n                            $nombre_vendedor = $vendedor ? $vendedor->display_name : 'Usuario MeBook';\n                            $avatar_url = get_avatar_url($libro->usuario_id);\n\n                            \/\/ Colores seg\u00fan Estado\n                            $bg_estado = 'bg-gray-500';\n                            if(stripos($libro->estado, 'nuevo') !== false) $bg_estado = 'bg-green-600';\n                            elseif(stripos($libro->estado, 'bueno') !== false) $bg_estado = 'bg-blue-500';\n                            elseif(stripos($libro->estado, 'usado') !== false) $bg_estado = 'bg-orange-500';\n                        ?>\n\n                        <div class=\"group bg-white rounded-2xl border border-[#f0f5f4] overflow-hidden hover:shadow-lg hover:border-primary\/30 transition-all duration-300 flex flex-col h-full\">\n                            \n                            <div class=\"relative aspect-[2\/3] overflow-hidden bg-gray-100\">\n                                <a href=\"<?php echo home_url('\/detalle-libro\/'); ?>?id_libro=<?php echo $libro->id; ?>\">\n                                    <img src=\"<?php echo esc_url($img_final); ?>\" class=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\" alt=\"<?php echo esc_attr($libro->titulo); ?>\"\/>\n                                <\/a>\n                                <div class=\"absolute top-3 left-3\">\n                                    <span class=\"inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-bold text-white backdrop-blur-sm shadow-sm <?php echo $bg_estado; ?>\/90\">\n                                        <?php echo esc_html($libro->estado); ?>\n                                    <\/span>\n                                <\/div>\n                            <\/div>\n\n                            <div class=\"p-4 flex flex-col flex-1 gap-3\">\n                                <div class=\"flex-1\">\n                                    <h3 class=\"text-lg font-bold text-text-main leading-tight line-clamp-2 group-hover:text-primary transition-colors\">\n                                        <a href=\"<?php echo home_url('\/detalle-libro\/'); ?>?id_libro=<?php echo $libro->id; ?>\">\n                                            <?php echo esc_html($libro->titulo); ?>\n                                        <\/a>\n                                    <\/h3>\n                                    <p class=\"text-sm text-text-secondary mt-1\"><?php echo esc_html($libro->autor); ?><\/p>\n                                <\/div>\n\n                                <div class=\"flex items-center gap-2 pt-2 border-t border-[#f0f5f4]\">\n                                    <img src=\"<?php echo $avatar_url; ?>\" class=\"size-6 rounded-full border border-gray-200\">\n                                    <span class=\"text-xs text-text-main font-medium truncate\"><?php echo $nombre_vendedor; ?><\/span>\n                                <\/div>\n\n                                <div class=\"flex items-center justify-between gap-2 mt-1\">\n                                    <div class=\"flex items-center gap-1 text-primary font-bold text-lg\">\n                                        <span class=\"text-base\">\ud83d\udc8e<\/span> <?php echo number_format($libro->precio, 0); ?>\n                                    <\/div>\n                                    <a href=\"<?php echo home_url('\/detalle-libro\/'); ?>?id_libro=<?php echo $libro->id; ?>\" class=\"size-9 rounded-xl bg-[#f0f5f4] hover:bg-primary hover:text-white text-primary flex items-center justify-center transition-all shadow-sm\">\n                                        <span class=\"material-symbols-outlined text-[20px]\">add_shopping_cart<\/span>\n                                    <\/a>\n                                <\/div>\n                            <\/div>\n                        <\/div>\n                        <?php endforeach; ?>\n                    <?php endif; ?>\n\n                <\/div>\n                <\/div>\n        <\/div>\n    <\/div>\n    <?php\n    return ob_get_clean();\n}","active":true,"modified":"2026-01-12 15:44:55","revision":"1"}]}
