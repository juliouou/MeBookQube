{"generator":"Code Snippets v3.9.3","date_created":"2026-01-19 13:12","snippets":[{"id":19,"name":"Perfil Publico","code":"add_shortcode('mebook_perfil', 'mebook_render_perfil_dashboard');\n\nfunction mebook_render_perfil_dashboard() {\n    global $wpdb;\n    \n    \/\/ 1. Seguridad: Verificar Login\n    if (!is_user_logged_in()) {\n        return '<script>window.location.href=\"\/login\";<\/script>';\n    }\n\n    \/\/ 2. Obtener datos del usuario LOGUEADO\n    $current_user = wp_get_current_user();\n    $user_id = $current_user->ID;\n    $nombre = $current_user->display_name;\n    $usuario_handle = $current_user->user_login;\n    $email = $current_user->user_email;\n    \n    \/\/ Foto de Perfil\n    $foto_custom = get_user_meta($user_id, 'mebook_avatar_custom', true);\n    $avatar_url = $foto_custom ? $foto_custom : 'https:\/\/www.gravatar.com\/avatar\/' . md5(strtolower(trim($email))) . '?d=mp&s=200';\n    \n    \/\/ Ubicaci\u00f3n\n    $ubicacion = get_user_meta($user_id, 'ciudad', true);\n    if(!$ubicacion) $ubicacion = 'Loja, Ecuador';\n\n    \/\/ Saldo MeBokies (myCred o custom)\n    $mebokies = get_user_meta($user_id, 'mycred_default', true);\n    if($mebokies === '') {\n        $mebokies = get_user_meta($user_id, 'mebook_saldo', true);\n    }\n    if($mebokies === '') $mebokies = 0; \n\n    \/\/ 3. CONSULTA DE LIBROS\n    $tabla_libros = 'libros'; \n    $mis_libros = $wpdb->get_results(\"SELECT * FROM $tabla_libros WHERE usuario_id = $user_id ORDER BY id DESC\");\n    $total_libros = count($mis_libros);\n\n    \/\/ Render HTML\n    ob_start();\n    ?>\n\n    <script src=\"https:\/\/cdn.tailwindcss.com?plugins=forms,container-queries\"><\/script>\n    <link href=\"https:\/\/fonts.googleapis.com\/css2?family=Lexend:wght@300;400;500;600;700&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200\" rel=\"stylesheet\"\/>\n    \n    <style>\n        body { font-family: 'Lexend', sans-serif; }\n        .mebook-shadow { box-shadow: 0 10px 40px -10px rgba(0,76,66,0.15); }\n    <\/style>\n\n    <div class=\"bg-[#F8FAFC] w-full min-h-screen text-[#0f172a] p-4 lg:p-8\">\n        \n        <div class=\"max-w-4xl mx-auto bg-white rounded-3xl p-8 mebook-shadow mb-10 border border-slate-100 relative overflow-hidden\">\n            <div class=\"absolute top-0 left-0 w-full h-24 bg-gradient-to-r from-[#004c42] to-[#00685a]\"><\/div>\n            \n            <div class=\"relative flex flex-col md:flex-row items-center md:items-end gap-6 mt-4\">\n                <div class=\"relative group\">\n                    <img src=\"<?php echo esc_url($avatar_url); ?>\" class=\"w-32 h-32 rounded-full border-4 border-white shadow-lg object-cover bg-white\">\n                    <a href=\"\/editar-perfil\" class=\"absolute bottom-0 right-0 bg-[#004c42] text-white p-2 rounded-full hover:scale-110 transition shadow-md\" title=\"Cambiar Foto\">\n                        <span class=\"material-symbols-outlined text-sm\">photo_camera<\/span>\n                    <\/a>\n                <\/div>\n                \n                <div class=\"flex-1 text-center md:text-left mb-2\">\n                    <h1 class=\"text-3xl font-bold text-[#0f172a]\"><?php echo esc_html($nombre); ?><\/h1>\n                    <p class=\"text-slate-500 font-medium\">@<?php echo esc_html($usuario_handle); ?> \u2022 <?php echo esc_html($ubicacion); ?><\/p>\n                <\/div>\n\n                <div class=\"flex gap-3 mb-2\">\n                    <a href=\"\/publicar-libro\" class=\"bg-[#004c42] hover:bg-[#003831] text-white px-6 py-3 rounded-xl font-semibold transition-all shadow-lg flex items-center gap-2 no-underline\">\n                        <span class=\"material-symbols-outlined\">add_circle<\/span> Vender Libro\n                    <\/a>\n                    <a href=\"\/editar-perfil\" class=\"bg-white border border-slate-200 text-slate-700 hover:border-[#004c42] hover:text-[#004c42] px-4 py-3 rounded-xl font-semibold transition-all shadow-sm flex items-center gap-2 no-underline\" title=\"Configuraci\u00f3n\">\n                        <span class=\"material-symbols-outlined\">settings<\/span>\n                    <\/a>\n                <\/div>\n            <\/div>\n\n            <div class=\"grid grid-cols-2 gap-4 mt-8 pt-6 border-t border-slate-100\">\n                \n                <div class=\"bg-slate-50 p-4 rounded-2xl border border-slate-100 flex flex-col items-center\">\n                    <span class=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Mis MeBokies<\/span>\n                    <div class=\"text-[#004c42] flex items-center gap-1 mt-1\">\n                        <span class=\"text-2xl\">\ud83d\udc8e<\/span>\n                        <span class=\"text-2xl font-bold\"><?php echo number_format($mebokies, 0); ?><\/span>\n                    <\/div>\n                <\/div>\n\n                <div class=\"bg-slate-50 p-4 rounded-2xl border border-slate-100 flex flex-col items-center\">\n                    <span class=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Libros Activos<\/span>\n                    <div class=\"text-[#004c42] flex items-center gap-1 mt-1\">\n                        <span class=\"material-symbols-outlined text-2xl\">menu_book<\/span>\n                        <span class=\"text-2xl font-bold\"><?php echo $total_libros; ?><\/span>\n                    <\/div>\n                <\/div>\n            <\/div>\n        <\/div>\n\n        <div class=\"max-w-6xl mx-auto\">\n            <h2 class=\"text-xl font-bold text-[#0f172a] mb-6 flex items-center gap-2\">\n                <span class=\"material-symbols-outlined text-[#004c42]\">inventory_2<\/span> Mis Libros\n            <\/h2>\n\n            <div class=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6\">\n                \n                <?php if ($mis_libros): ?>\n                    <?php foreach ($mis_libros as $libro): \n                        $estado = $libro->disponibilidad; \n                        $badge_bg = 'bg-[#004c42]';\n                        $opacity = '';\n                        \n                        if($estado === 'vendido') {\n                            $badge_bg = 'bg-slate-500';\n                            $opacity = 'opacity-60 grayscale';\n                        } elseif($estado === 'pendiente') {\n                            $badge_bg = 'bg-yellow-500';\n                        }\n                        \n                        $img = !empty($libro->imagen) ? $libro->imagen : 'https:\/\/via.placeholder.com\/300x400?text=Sin+Portada';\n                    ?>\n                    \n                    <div class=\"bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden group border border-slate-100 <?php echo $opacity; ?>\">\n                        <div class=\"relative h-64 overflow-hidden\">\n                            <div class=\"absolute inset-0 bg-cover bg-center transition-transform duration-500 group-hover:scale-110\" style=\"background-image: url('<?php echo esc_url($img); ?>');\"><\/div>\n                            \n                            <span class=\"absolute top-3 left-3 <?php echo $badge_bg; ?> text-white text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-wide shadow-sm\">\n                                <?php echo ucfirst($estado); ?>\n                            <\/span>\n\n                            <div class=\"absolute inset-0 bg-black\/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-3 backdrop-blur-[2px]\">\n                                <a href=\"\/editar-libro?id=<?php echo $libro->id; ?>\" class=\"bg-white text-[#004c42] p-2 rounded-full hover:scale-110 transition shadow-lg\">\n                                    <span class=\"material-symbols-outlined\">edit<\/span>\n                                <\/a>\n                            <\/div>\n                        <\/div>\n\n                        <div class=\"p-4\">\n                            <h3 class=\"font-bold text-[#0f172a] truncate mb-1\"><?php echo esc_html($libro->titulo); ?><\/h3>\n                            <div class=\"flex justify-between items-center border-t border-slate-100 pt-3\">\n                                <span class=\"font-bold text-[#004c42] text-lg\">\ud83d\udc8e <?php echo number_format($libro->precio, 0); ?><\/span>\n                            <\/div>\n                        <\/div>\n                    <\/div>\n                    <?php endforeach; ?>\n\n                <?php else: ?>\n                    <div class=\"col-span-full py-12 text-center bg-white rounded-2xl border border-dashed border-slate-300\">\n                        <span class=\"material-symbols-outlined text-4xl text-slate-300 mb-2\">library_add<\/span>\n                        <p class=\"text-slate-500\">A\u00fan no tienes libros publicados.<\/p>\n                        <a href=\"\/publicar-libro\" class=\"text-[#004c42] font-bold hover:underline mt-2 inline-block\">\u00a1Gana MeBokies vendiendo uno!<\/a>\n                    <\/div>\n                <?php endif; ?>\n\n            <\/div>\n        <\/div>\n    <\/div>\n    <?php\n    return ob_get_clean();\n}","active":true,"modified":"2026-01-14 17:33:36","revision":"1"}]}