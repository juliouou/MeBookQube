{"generator":"Code Snippets v3.9.3","date_created":"2026-01-19 13:11","snippets":[{"id":5,"name":"Mostrar Libros MeBook","code":"add_shortcode( 'carrusel_libros', 'funcion_carrusel_nuclear_fix' );\n\nfunction funcion_carrusel_nuclear_fix( $atts ) {\n    global $wpdb;\n    \n    \/\/ Configuraci\u00f3n\n    $a = shortcode_atts( array(\n        'tipo'   => 'recientes', \n        'cat'    => '',\n        'limite' => 8\n    ), $atts );\n\n    \/\/ Obtener la URL real actual (Ngrok)\n    $url_base = get_home_url(); \n\n    \/\/ SQL: Solo disponibles\n    $sql = \"SELECT * FROM libros WHERE disponibilidad = 'disponible'\";\n\n    if ( $a['tipo'] == 'baratos' ) {\n        $sql .= \" AND precio <= 15 ORDER BY precio ASC\";\n    } elseif ( $a['tipo'] == 'por_categoria' && !empty($a['cat']) ) {\n        $sql .= $wpdb->prepare(\" AND categorias = %s ORDER BY id DESC\", $a['cat']);\n    } else {\n        $sql .= \" ORDER BY id DESC\";\n    }\n    $sql .= \" LIMIT \" . intval($a['limite']);\n\n    $libros = $wpdb->get_results( $sql );\n    if ( empty( $libros ) ) return '';\n\n    ob_start();\n    ?>\n    \n    <style>\n        .contenedor-carrusel-mebook {\n            display: flex; gap: 20px; overflow-x: auto; padding: 20px 5px;\n            scrollbar-width: thin; scrollbar-color: #004d40 #f0f0f0;\n        }\n        .tarjeta-libro {\n            min-width: 180px; max-width: 180px; background: white; border-radius: 12px;\n            box-shadow: 0 4px 10px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid #eee;\n            transition: transform 0.3s; display: flex; flex-direction: column;\n        }\n        .tarjeta-libro:hover { transform: translateY(-5px); border-color: #004d40; }\n        .imagen-libro {\n            width: 100%; height: 220px; background-size: cover; background-position: center;\n            background-color: #f4f4f4;\n        }\n        .info-libro { padding: 12px; }\n        .info-libro h3 { font-size: 14px; margin: 0 0 5px; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: bold; }\n        .autor { font-size: 12px; color: #777; margin: 0 0 10px; font-style: italic; }\n        .precio-boton { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }\n        .precio { font-weight: 800; color: #004d40; }\n    <\/style>\n\n    <div class=\"contenedor-carrusel-mebook\">\n        <?php foreach ( $libros as $libro ) : \n            \n            \/\/ --- LA SOLUCI\u00d3N NUCLEAR ---\n            $img_origen = $libro->imagen;\n            $img_final = $img_origen;\n\n            \/\/ Cortamos la URL justo donde dice '\/wp-content\/'\n            \/\/ Esto ignora si antes dec\u00eda 'localhost' o lo que sea.\n            if ( strpos($img_origen, 'wp-content') !== false ) {\n                $partes = explode('\/wp-content\/', $img_origen);\n                \/\/ $partes[1] es lo que sigue despu\u00e9s (uploads\/2025\/foto.jpg)\n                \n                \/\/ Reconstruimos: URL_NGROK + \/wp-content\/ + RESTO\n                if ( isset($partes[1]) ) {\n                    $img_final = $url_base . '\/wp-content\/' . $partes[1];\n                }\n            }\n        ?>\n            <div class=\"tarjeta-libro\">\n                <a href=\"<?php echo home_url('\/detalle-libro\/'); ?>?id_libro=<?php echo $libro->id; ?>\" style=\"text-decoration:none; color:inherit;\">\n                    \n                    <div class=\"imagen-libro\" style=\"background-image: url('<?php echo esc_url($img_final); ?>');\"><\/div>\n                    \n                    <div class=\"info-libro\">\n                        <h3><?php echo esc_html($libro->titulo); ?><\/h3>\n                        <p class=\"autor\"><?php echo esc_html($libro->autor); ?><\/p>\n                        <div class=\"precio-boton\">\n                            <span class=\"precio\"><?php echo esc_html($libro->precio); ?> \ud83d\udc8e<\/span>\n                            <span style=\"font-size:12px; color:#004d40; font-weight:bold;\">Ver \u2192<\/span>\n                        <\/div>\n                    <\/div>\n                <\/a>\n            <\/div>\n        <?php endforeach; ?>\n    <\/div>\n    <?php\n    return ob_get_clean();\n}","active":true,"modified":"2026-01-07 17:20:35","revision":"1"}]}